<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
    </head>
    <body>
        <div id="main"></div>
        <div class="sum">total: 120 ms</div>
        <style>
            img {
                position: absolute;
                width: 100px;
                height: 100px;
                z-index: -1;
            }

            .image {
                display: flex;
                float: left;
                flex-wrap: wrap;
                position: relative;
                width: 100px;
                height: 100px;
            }
            .time {
                position: absolute;
                margin: 4px;
                padding: 2px 4px;
                background: white;
            }
            .sum {
                position: fixed;
                text-align: center;
                line-height: 130px;
                font-size: 50px;
                left: 50%;
                top: 25%;
                opacity: 0;
                transform: translate(-50%, 25%);
                width: 400px;
                height: 130px;
                background: white;
                border-radius: 5px;
                box-shadow: 2px 2px 20px rgba(0, 0, 0, 0.8);
                transition: opacity 500ms ease;
            }
        </style>
        <script>
            const main = document.getElementById('main');
            const sum = document.querySelector('.sum');

            const buildPage = async () => {
                console.time('render dom tree');
                let sumTime = 0;

                for (let i = 1; i < 101; i++) {
                    const s = Date.now();

                    await fetch(`/photos/${i}`)
                        .then((res) => res.json())
                        .then((data) => {
                            const d = Date.now() - s;

                            const time = document.createElement('div');
                            time.classList.add('image');
                            time.innerHTML = `<div class="time">${d} ms</div>`;

                            const img = document.createElement('img');
                            img.setAttribute('defert', true);
                            img.setAttribute('src', data.thumbnailUrl);
                            time.appendChild(img);
                            main.appendChild(time);
                            sumTime += d;
                            return d;
                        })
                        .catch((err) => console.log(err));
                }
                sum.innerHTML = `total: ${sumTime / 1000} s`;
                sum.style.opacity = 1;

                console.timeEnd('render dom tree');
            };
            buildPage();
        </script>
    </body>
</html>
